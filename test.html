<!DOCTYPE html>
<html>
<head>
	<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
	<script src="./components/show-info.js"></script>
	<script src="https://rawgit.com/chenzlabs/gearvr-controls/master/dist/aframe-gearvr-controls-component.min.js"></script>

</head>
<script>
	var g_endpoint = "vmworld/TowerBridge/temperature";
	function createCORSRequest(method, url) {
		var xhr = new XMLHttpRequest();
		if ("withCredentials" in xhr) {
			xhr.open(method, url, true);
		} else if (typeof XDomainRequest != "undefined") {
			xhr = new XDomainRequest();
			xhr.open(method, url);
		} else {
			xhr = null;
		}

		/* xhr.onload = function() {
			console.log(xhr.responseText);
			var json = JSON.parse(xhr.responseText);
			var str = json["_id"] + '\n';
			for (var key in json["payload"])
				if (json["payload"].hasOwnProperty(key)) {
					var val = json["payload"][key];
					str += key + ' -> ' + val + '\n';
				}
			console.log(str);
			console.log(document.getElementById("text").getAttribute("text"));
			document.getElementById("text").setAttribute("text", "value: " + str);
			console.log(json)
		} */

		xhr.onload = function() {
			console.log(xhr.responseText);
			var json = JSON.parse(xhr.responseText);
			var str = "";
			for (var key in json)
				if (json.hasOwnProperty(key)){
					var val = json[key];
					str += key + ' -> ' + val + '\n';
				}
			document.getElementById("text").setAttribute("text", "value: " + str);
			request_end(g_endpoint);
		} 

  		return xhr;
	}

	function request(){
		var url = "http://104.236.133.46:5000/"
		var xhr = createCORSRequest('GET', url + document.getElementById("endpoint_id").value);
		xhr.send();
		//return JSON.parse(xhr.responseText);
	}

	function request_end(endpoint){
		var url = "http://104.236.133.46:5000/collections/"
		var xhr = createCORSRequest('GET', url + endpoint)
		xhr.send()
	}

	function request_doc(col, doc){
		var url = "http://104.236.133.46:5000/collections/";
		var xhr = createCORSRequest('GET', url + col + "/" + doc);
		xhr.send();
	}

	function poll_end()
	{
		request_end(g_endpoint);
	}
</script>
<body onload="poll_end()">
		<a-scene>
		  <a-assets>
	                <a-asset-item id="object" src="./models/Tower03_sketchup.obj"></a-asset-item>
	                <a-asset-item id="material" src="./models/Tower03_sketchup.mtl"></a-asset-item>
			<img id="skyTexture" src="https://cdn.aframe.io/a-painter/images/sky.jpg"></img>
			<img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg"></img>
	            </a-assets>
				<a-camera wasd-controls="fly: true" gearvr-controls="fly: true"  position="0 2 0">
	      <a-entity id="text" material="opacity: 0.5"
	        position="0 0 -1"
	        geometry="primitive: plane; width: auto; height: auto"
	        material="color: #0000FF"
	        text="value: ">
					<a-cursor color="#4CC3D9" fuse="true" timeout="10"></a-cursor>
				</a-camera>
	      <a-obj-model src="#object" color="#998860" position="0 0 -2" rotation="0 -55 0 " scale="0.001 0.001 0.001"></a-obj-model>


	      </a-entity>
		<a-entity gearvr-controls></a-entity>
	      <a-box show-info id="vmworld/TowerBridge/temperature" position="1.849 3.993 -2.673" scale="0.2 0.2 0.2" rotation="0 45 0" color="#4CC3D9"></a-box>
	      <a-box show-info id="vmworld/TowerBridge/inclination" position="0.229 1.294 -2.403" scale="0.2 0.2 0.2" rotation="0 45 0" color="#4CC3D9"></a-box>
	      <a-box show-info id="vmworld/TowerBridge/earthquake" position="3.199 1.9 -2.918" scale="0.2 0.2 0.2" rotation="0 45 0" color="#4CC3D9"></a-box>
		<a-cylinder id="ground" src="#groundTexture" radius="30" height="0.1"></a-cylinder>
	      <a-sky id="background" src="#skyTexture" theta-length="90" radius="30"></a-sky>
	    </a-scene>

</body>
</html>
